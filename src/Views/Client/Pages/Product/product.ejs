<%- include("../../Layouts/header") %>

<div class="container-fluid">
    <div class="row">
        <div class="col-12 d-flex justify-content-between align-items-center my-3">
            <form action="/products/filter" method="GET" class="d-flex align-items-center bg-white p-2 rounded">
            <select name="priceRange" class="form-control me-2">
                <option value="">Chọn khoảng giá</option>
                <option value="0-100.000">Dưới 100.000</option>
                <option value="100.000-300.000">100.000 - 300.000</option>
                <option value="300.000-500.000">300.000 - 500.000</option>
            </select>
            <button type="submit" class="btn btn-primary" style="height: 45px;">Lọc</button>
            </form>
            <form action="/search" method="GET" class="d-flex bg-white p-2 rounded">
                <input type="text" name="query" class="form-control me-2" placeholder="Tìm sản phẩm..." required>
                <button type="submit" class="btn btn-primary">Tìm kiếm</button>
            </form>
        </div>
    </div>
</div>

<div class="main-container">
    <div class="sidebar-section">
        <strong>
            <h3 class="h3">Danh mục sản phẩm</h3>
        </strong>
        <ul>
            <li><a href="/products">Quản trị và lãnh đạo</a></li>
            <li><a href="/products">Tâm linh, triết lý</a></li>
            <li><a href="/products">Văn hóa, lịch sử</a></li>
            <li><a href="/products">Tâm lý học, xã hội học</a></li>
            <li><a href="/products">Tiểu thuyết trinh thám, pháp y, tội phạm</a></li>
            <li><a href="/products">Khoa học, công nghệ</a></li>
        </ul>
    </div>

    <div class="product-section">
        <div class="product-grid">
            <% if (products && products.length > 0) { %>
            <% products.forEach(product => { %>
            <div class="product-card">
                <a href="/product/<%= product.productId %>">
                    <img src="/client/images/<%= product.images %>" alt="<%= product.title %>">
                    <div class="title"><%= product.title %></div>
                    <div class="price"><%= product.price.toLocaleString('vi-VN') %> VND</div>
                </a>
                <form action="/cart/add" method="POST">
                    <input type="hidden" name="product_id" value="<%= product.productId %>">
                    <button type="submit" class="btn btn-success">Thêm vào giỏ hàng</button>
                </form>
            </div>
            <% }) %>
            <% } else { %>
            <p>Không tìm thấy sản phẩm nào.</p>
            <% } %>
        </div>
    </div>
</div>

<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
        <% if (typeof currentPage !== 'undefined' && currentPage > 1) { %>
            <li class="page-item">
                <a class="page-link" href="/products?page=<%= currentPage - 1 %>">« Trước</a>
            </li>
        <% } %>

        <% for (let i = 1; i <= totalPages; i++) { %>
            <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                <a class="page-link" href="/products?page=<%= i %>"><%= i %></a>
            </li>
        <% } %>

        <% if (typeof currentPage !== 'undefined' && currentPage < totalPages) { %>
            <li class="page-item">
                <a class="page-link" href="/products?page=<%= currentPage + 1 %>">Tiếp »</a>
            </li>
        <% } %>
    </ul>
</nav>

<%- include("../../Layouts/footer") %>
